{"version":3,"sources":["config.js","log.js","pwa-register.js","gallery.js"],"names":["config","backEnd","maxSize","renderThumbnail","batchProcessing","squareImage","floatPrecision","registerPWA","classify","name","modelPath","score","topK","alternative","detect","overlap","person","type","dot","div","document","getElementById","innerHTML","result","msg","msgs","map","a","replace","scrollTop","scrollHeight","length","fetch","console","log","active","register","path","navigator","found","serviceWorker","getRegistrations","then","regs","reg","state","catch","err","code","message","scope","pwa","results","filtered","options","listFolders","localStorage","getItem","val","setItem","listDetails","listDivider","listSortOrder","listThumbSize","parseInt","listLimit","viewDetails","viewBoxes","viewFaces","viewRaw","dateShort","dateLong","dateDivider","fontSize","gtag","window","dataLayer","push","arguments","showTip","parent","text","tip","createElement","id","role","className","appendChild","popper","Popper","createPopper","placement","strategy","modifiers","offset","setTimeout","destroy","removeChild","drawBoxes","img","object","canvas","style","position","left","offsetLeft","top","offsetTop","width","height","ctx","getContext","clearRect","linewidth","font","resizeX","processedSize","resizeY","strokeStyle","fillStyle","obj","x","box","y","beginPath","rect","stroke","fillText","toFixed","class","i","pointSize","pt","points","arc","Math","PI","fill","JSONtoStr","json","JSON","stringify","showDetails","open","$","toggle","find","image","classified","detected","nsfw","age","scoreGender","gender","scoreEmotion","emotion","scoreClass","desc","descriptions","description","lines","exif","mp","naturalWidth","naturalHeight","complexity","bytes","make","model","lens","toLocaleString","created","moment","format","modified","software","exposure","fov","iso","apperture","location","city","country","continent","near","lat","lon","link","html","perf","total","processed","load","tags","css","innerWidth","showNextDetails","findIndex","src","previous","addDividers","curr","timestamp","prev","append","round","pixels","substr","lastIndexOf","printResult","all","sort","b","Set","item","personCount","max","divItem","root","user","thumbnail","decodeURI","naturalSize","divThumb","addEventListener","evt","target","resizeResults","thumbSize","value","enumerateFolders","list","folders","split","filter","folder","j","parentElem","currentElem","click","attr","startsWith","redrawResults","generateFolders","filterWord","word","skip","includes","res","ok","tag","str","Object","values","toString","toLowerCase","filterResults","words","foundWords","shuffle","array","currentIndex","temporaryValue","randomIndex","floor","random","findDuplicates","items","hash","sortResults","loadGallery","limit","t0","performance","now","t1","size","initUser","toggleClass","admin","initHandlers","post","hasClass","focus","md","marked","keyup","event","preventDefault","keyCode","on","screenX","keydown","current","line","page","bottom","prop","stop","animate","hideElements","main","Date","page_path","pathname","user_id","onload"],"mappings":"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","file":"gallery.js","sourceRoot":"../client","sourcesContent":["/* eslint-disable no-multi-spaces */\n\nconst config = {\n  // General configuration\n  backEnd: 'webgl',        // back-end used by tensorflow for image processing, can be webgl, cpu, wasm\n  maxSize: 780,            // maximum image width or height that will be used for processing before resizing is required\n  renderThumbnail: 230,    // resolution in which to store image thumbnail embedded in result set\n  batchProcessing: 1,      // how many images to process in parallel\n  squareImage: false,      // resize proportional to the original image or to a square image\n  floatPrecision: false,   // use float32 or float16 for WebGL tensors\n  registerPWA: false,      // register PWA service worker?\n\n  // Default models\n  classify: { name: 'Inception v3', modelPath: 'models/inception-v3/model.json', score: 0.2, topK: 3 },\n  alternative: { name: 'MobileNet v2', modelPath: '/models/mobilenet-v2/model.json', score: 0.2, topK: 3 },\n  detect: { name: 'Coco/SSD v2', modelPath: 'models/cocossd-v2/model.json', score: 0.4, topK: 6, overlap: 0.1 },\n  person: { name: 'FaceAPI SSD', modelPath: 'models/faceapi/', score: 0.4, topK: 4, type: 'ssdMobilenetv1' },\n\n  /*\n  models that can be used for \"classify\" and \"alternative\" can be found at\n    https://tfhub.dev/s?deployment-format=tfjs&module-type=image-classification&tf-version=tf2\n  or just pick one from below\n    classify: { name: 'MobileNet v1', modelPath: 'https://tfhub.dev/google/tfjs-model/imagenet/mobilenet_v1_100_224/classification/3/default/1' },\n    classify: { name: 'MobileNet v2', modelPath: 'https://tfhub.dev/google/tfjs-model/imagenet/mobilenet_v2_100_224/classification/3/default/1' },\n    classify: { name: 'Inception v1', modelPath: 'https://tfhub.dev/google/tfjs-model/imagenet/inception_v1/classification/3/default/1' },\n    classify: { name: 'Inception v2', modelPath: 'https://tfhub.dev/google/tfjs-model/imagenet/inception_v2/classification/3/default/1' },\n    classify: { name: 'Inception v3', modelPath: 'https://tfhub.dev/google/tfjs-model/imagenet/inception_v3/classification/3/default/1' },\n    classify: { name: 'Inception ResNet v2', modelPath: 'https://tfhub.dev/google/tfjs-model/imagenet/inception_resnet_v2/classification/3/default/1' },\n    classify: { name: 'ResNet v2', modelPath: 'https://tfhub.dev/google/tfjs-model/imagenet/resnet_v2_101/classification/3/default/1' },\n    classify: { name: 'NasNet Mobile', modelPath: 'https://tfhub.dev/google/tfjs-model/imagenet/nasnet_mobile/classification/3/default/1' },\n  */\n\n  /*\n  models that can be used for \"detect\" can be found at\n    https://tfhub.dev/s?deployment-format=tfjs&module-type=image-object-detection\n  or just pick one from below\n    detect: { name: 'Coco/SSD v1', modelPath: 'https://tfhub.dev/tensorflow/tfjs-model/ssd_mobilenet_v1/1/default/1', score: 0.4, topK: 6, overlap: 0.1 },\n    detect: { name: 'Coco/SSD v2', modelPath: 'https://tfhub.dev/tensorflow/tfjs-model/ssd_mobilenet_v2/1/default/1', score: 0.4, topK: 6, overlap: 0.1 },\n  or enable darknet/yolo model in a separate module (js module is not initialized by default)\n  */\n\n  /*\n  models that can be used for \"person\" are\n    person: { name: 'FaceAPI SSD', modelPath: 'models/faceapi/', score: 0.5, topK: 1, type: 'ssdMobilenetv1' },\n    person: { name: 'FaceAPI Yolo', modelPath: 'models/faceapi/', score: 0.5, topK: 1, type: 'tinyYolov2' },\n    person: { name: 'FaceAPI Tiny', modelPath: 'models/faceapi/', score: 0.5, topK: 1, type: 'tinyFaceDetector' },\n    person: { name: 'FaceAPI MTCNN', modelPath: 'models/faceapi/', score: 0.5, topK: 1, type: 'mtcnn' },\n  */\n};\n\nexport default config;\n","async function dot() {\n  const div = document.getElementById('log');\n  if (div) div.innerHTML += '.';\n}\n\nasync function result(...msg) {\n  let msgs = '';\n  msgs += msg.map((a) => a);\n  const div = document.getElementById('log');\n  if (div) div.innerHTML += `${msgs.replace(' ', '&nbsp')}<br>`;\n  if (div) div.scrollTop = div.scrollHeight;\n  if (msgs.length > 0) fetch(`/api/log?msg=${msgs}`); // .then((res) => res.text());\n  // eslint-disable-next-line no-console\n  console.log(...msg);\n}\n\nasync function active(...msg) {\n  const div = document.getElementById('active');\n  if (div) div.innerHTML = `${msg}<br>`;\n  // eslint-disable-next-line no-console\n  else console.log(...msg);\n}\n\nconst log = {\n  result,\n  active,\n  dot,\n};\n\nexport default log;\n","import log from './log.js';\n\nasync function register(path) {\n  if ('serviceWorker' in navigator) {\n    try {\n      let found = false;\n      navigator.serviceWorker.getRegistrations()\n        .then((regs) => {\n          for (const reg of regs) {\n            if (reg.active && reg.active.state === 'activated') found = true;\n          }\n          return found;\n        })\n        .catch((err) => {\n          log.result(`PWA Error: code ${err.code} ${err.name} - ${err.message}`);\n        });\n      if (!found) {\n        navigator.serviceWorker\n          .register(path, { scope: '/' })\n          .then((reg) => {\n            log.result(`PWA Registration scope: ${reg.scope}`);\n          })\n          .catch((err) => {\n            if (err.name === 'SecurityError') log.result('SSL certificate is untrusted');\n            else log.result(`PWA Error: code ${err.code} ${err.name} - ${err.message}`);\n          });\n      }\n    } catch (err) {\n      if (err.name === 'SecurityError') log.result('SSL certificate is untrusted');\n      else log.result(`PWA Error: code ${err.code} ${err.name} - ${err.message}`);\n    }\n  }\n}\n\nconst pwa = {\n  register,\n};\n\nexport default pwa;\n","/* global moment, marked, Popper */\n\nimport config from './config.js';\nimport log from './log.js';\nimport pwa from './pwa-register.js';\n\nlet results = [];\nlet filtered = [];\n\nconst options = {\n  get listFolders() { return localStorage.getItem('listFolders') || true; },\n  set listFolders(val) { return localStorage.setItem('listFolders', val); },\n  get listDetails() { return localStorage.getItem('listDetails') || true; },\n  set listDetails(val) { return localStorage.setItem('listDetails', val); },\n  get listDivider() { return localStorage.getItem('listDivider') || 'month'; },\n  set listDivider(val) { return localStorage.setItem('listDivider', val); },\n  get listSortOrder() { return localStorage.getItem('listSortOrder') || 'numeric-down'; },\n  set listSortOrder(val) { return localStorage.setItem('listSortOrder', val); },\n  get listThumbSize() { return parseInt(localStorage.getItem('listThumbSize') || 130, 10); },\n  set listThumbSize(val) { return localStorage.setItem('listThumbSize', val); },\n  get listLimit() { return parseInt(localStorage.getItem('listLimit') || 100, 10); },\n  set listLimit(val) { return localStorage.setItem('listLimit', val); },\n  get viewDetails() { return localStorage.getItem('viewDetails') || true; },\n  set viewDetails(val) { return localStorage.getItem('viewDetails', val); },\n  get viewBoxes() { return localStorage.getItem('viewBoxes') || true; },\n  set viewBoxes(val) { return localStorage.getItem('viewBoxes', val); },\n  get viewFaces() { return localStorage.getItem('viewFaces') || true; },\n  set viewFaces(val) { return localStorage.getItem('viewFaces', val); },\n  get viewRaw() { return localStorage.getItem('viewRaw') || false; },\n  set viewRaw(val) { return localStorage.getItem('viewRaw', val); },\n  get dateShort() { return localStorage.getItem('dateShort') || 'YYYY/MM/DD'; },\n  set dateShort(val) { return localStorage.getItem('dateShort', val); },\n  get dateLong() { return localStorage.getItem('dateLong') || 'dddd, MMMM Do, YYYY'; },\n  set dateLong(val) { return localStorage.getItem('dateLong', val); },\n  get dateDivider() { return localStorage.getItem('dateDivider') || 'MMMM YYYY'; },\n  set dateDivider(val) { return localStorage.getItem('dateDivider', val); },\n  get fontSize() { return localStorage.getItem('fontSize') || '14px'; },\n  set fontSize(val) { return localStorage.getItem('fontSize', val); },\n};\n\n// eslint-disable-next-line prefer-rest-params\nfunction gtag() { window.dataLayer.push(arguments); }\n\nfunction showTip(parent, text) {\n  const tip = document.createElement('div');\n  tip.id = 'tooltip';\n  tip.role = 'tooltip';\n  tip.className = 'popper';\n  tip.innerHTML = text;\n  parent.appendChild(tip);\n  let popper = Popper.createPopper(parent, tip, { placement: 'left', strategy: 'absolute', modifiers: [{ name: 'offset', options: { offset: [0, 20] } }] });\n  setTimeout(() => {\n    popper.destroy();\n    popper = null;\n    parent.removeChild(tip);\n  }, 3000);\n}\n\n// draw boxes for detected objects, faces and face elements\nfunction drawBoxes(img, object) {\n  const canvas = document.getElementById('popup-canvas');\n  canvas.style.position = 'absolute';\n  canvas.style.left = img.offsetLeft;\n  canvas.style.top = img.offsetTop;\n  canvas.width = img.width;\n  canvas.height = img.height;\n  const ctx = canvas.getContext('2d');\n  ctx.clearRect(0, 0, canvas.width, canvas.height);\n  ctx.linewidth = 2;\n  ctx.font = '16px Roboto';\n  const resizeX = img.width / object.processedSize.width;\n  const resizeY = img.height / object.processedSize.height;\n\n  // draw detected objects\n  if (options.viewBoxes && object.detect) {\n    ctx.strokeStyle = 'lightyellow';\n    ctx.fillStyle = 'lightyellow';\n    for (const obj of object.detect) {\n      const x = obj.box[0] * resizeX;\n      const y = obj.box[1] * resizeY;\n      ctx.beginPath();\n      ctx.rect(x, y, obj.box[2] * resizeX, obj.box[3] * resizeY);\n      ctx.stroke();\n      ctx.fillText(`${(100 * obj.score).toFixed(0)}% ${obj.class}`, x + 2, y + 18);\n    }\n  }\n\n  // draw faces\n  if (options.viewFaces && object.person) {\n    for (const i in object.person) {\n      if (object.person[i].box) {\n        // draw box around face\n        const x = object.person[i].box.x * resizeX;\n        const y = object.person[i].box.y * resizeY;\n        ctx.strokeStyle = 'deepskyblue';\n        ctx.fillStyle = 'deepskyblue';\n        ctx.beginPath();\n        ctx.rect(x, y, object.person[i].box.width * resizeX, object.person[i].box.height * resizeY);\n        ctx.stroke();\n        ctx.fillText(`face#${1 + parseInt(i, 10)}`, x + 2, y + 18);\n\n        // draw face points\n        ctx.fillStyle = 'lightblue';\n        const pointSize = 2;\n        for (const pt of object.person[i].points) {\n          ctx.beginPath();\n          ctx.arc(pt.x * resizeX, pt.y * resizeY, pointSize, 0, 2 * Math.PI);\n          ctx.fill();\n        }\n        /*\n        const jaw = person.boxes.landmarks.getJawOutline() || [];\n        const nose = person.boxes.landmarks.getNose() || [];\n        const mouth = person.boxes.landmarks.getMouth() || [];\n        const leftEye = person.boxes.landmarks.getLeftEye() || [];\n        const rightEye = person.boxes.landmarks.getRightEye() || [];\n        const leftEyeBrow = person.boxes.landmarks.getLeftEyeBrow() || [];\n        const rightEyeBrow = person.boxes.landmarks.getRightEyeBrow() || [];\n        faceDetails = `Points jaw:${jaw.length} mouth:${mouth.length} nose:${nose.length} left-eye:${leftEye.length} right-eye:${rightEye.length} left-eyebrow:${leftEyeBrow.length} right-eyebrow:${rightEyeBrow.length}`;\n        */\n      }\n    }\n  }\n}\n\nfunction JSONtoStr(json) {\n  if (json) return JSON.stringify(json).replace(/{|}|\"|\\[|\\]/g, '').replace(/,/g, ', ');\n}\n\n// show details popup\nasync function showDetails() {\n  const img = document.getElementById('popup-image');\n  if (options.viewRaw) {\n    window.open(img.img, '_blank');\n    return;\n  }\n  $('#popup').toggle(true);\n\n  const object = filtered.find((a) => a.image === img.img);\n  if (!object) return;\n\n  let classified = 'Classified ';\n  if (object.classify) for (const obj of object.classify) classified += ` | ${(100 * obj.score).toFixed(0)}% ${obj.class}`;\n  let alternative = 'Alternate ';\n  if (object.alternative) for (const obj of object.alternative) alternative += ` | ${(100 * obj.score).toFixed(0)}% ${obj.class}`;\n\n  let detected = 'Detected ';\n  if (object.detect) for (const obj of object.detect) detected += ` | ${(100 * obj.score).toFixed(0)}% ${obj.class}`;\n\n  let person = '';\n  let nsfw = '';\n  for (const i in object.person) {\n    if (object.person[i].age) {\n      person += `Person ${1 + parseInt(i, 10)} | \n          Gender: ${(100 * object.person[i].scoreGender).toFixed(0)}% ${object.person[i].gender} | \n          Age: ${object.person[i].age.toFixed(1)} | \n          Emotion: ${(100 * object.person[i].scoreEmotion).toFixed(0)}% ${object.person[i].emotion}<br>`;\n    }\n    if (object.person[i].class) {\n      nsfw += `Class: ${(100 * object.person[i].scoreClass).toFixed(0)}% ${object.person[i].class} `;\n    }\n    if (object.person.length === 1) person = person.replace('Person 1', 'Person');\n  }\n\n  let desc = '<h2>Lexicon:</h2><ul>';\n  if (object.descriptions) {\n    for (const description of object.descriptions) {\n      for (const lines of description) {\n        desc += `<li><b>${lines.name}</b>: <i>${lines.desc}</i></li>`;\n      }\n      desc += '<br>';\n    }\n  }\n  desc += '</ul>';\n\n  let exif = '';\n  if (object.exif) {\n    const mp = (img.naturalWidth * img.naturalHeight / 1000000).toFixed(1);\n    const complexity = (img.naturalWidth * img.naturalHeight) / object.exif.bytes;\n    if (object.exif.make) exif += `Camera: ${object.exif.make} ${object.exif.model || ''} ${object.exif.lens || ''}<br>`;\n    if (object.exif.bytes) exif += `Size: ${mp} MP in ${object.exif.bytes.toLocaleString()} bytes with compression factor ${complexity.toFixed(2)}<br>`;\n    if (object.exif.created) exif += `Taken: ${moment(1000 * object.exif.created).format(options.dateLong)} Edited: ${moment(1000 * object.exif.modified).format(options.dateLong)}<br>`;\n    if (object.exif.software) exif += `Software: ${object.exif.software}<br>`;\n    if (object.exif.exposure) exif += `Settings: ${object.exif.fov || 0}mm ISO${object.exif.iso || 0} f/${object.exif.apperture || 0} 1/${(1 / (object.exif.exposure || 1)).toFixed(0)}sec<br>`;\n  }\n  let location = '';\n  if (object.location && object.location.city) location += `Location: ${object.location.city}, ${object.location.state} ${object.location.country}, ${object.location.continent} (near ${object.location.near})<br>`;\n  if (object.exif && object.exif.lat) location += `Coordinates: Lat ${object.exif.lat.toFixed(3)} Lon ${object.exif.lon.toFixed(3)}<br>`;\n\n  const link = `<a class=\"download fa fa-arrow-alt-circle-down\" style=\"font-size: 32px\" href=\"${object.image}\" download></a>`;\n  const html = `\n      <h2>Image: ${object.image}</h2>${link}\n      Image size: ${img.naturalWidth} x ${img.naturalHeight}\n        Total time ${object.perf.total.toFixed(0)} ms<br>\n        Processed on ${moment(object.processed).format(options.dateLong)} in ${object.perf.load.toFixed(0)} ms<br>\n        Classified using ${config.classify ? config.classify.name : 'N/A'} in ${object.perf.classify.toFixed(0)} ms<br>\n        Alternative using ${config.alternative ? config.alternative.name : 'N/A'}<br>\n        Detected using ${config.detect ? config.detect.name : 'N/A'} in ${object.perf.detect.toFixed(0)} ms<br>\n        Person using ${config.person ? config.person.name : 'N/A'} in ${object.perf.person.toFixed(0)} ms<br>\n      <h2>Image Data</h2>\n      ${exif}\n      <h2>Location</h2>\n      ${location}\n      <h2>${classified}</h2>\n      <h2>${alternative}</h2>\n      <h2>${detected}</h2>\n      <h2>${person} ${nsfw}</h2>\n      ${desc}\n      <h2>Tags</h2>\n      <i>${JSONtoStr(object.tags)}</i>\n      </div>\n    `;\n  if (options.viewDetails) {\n    $('#popup-details').toggle(true);\n    $('#popup-image').css('max-width', '80vw');\n    $('#popup-details').width(window.innerWidth - $('#popup-image').width());\n    $('#popup-details').html(html);\n  } else {\n    $('#popup-details').toggle(false);\n    $('#popup-image').css('max-width', '100vw');\n  }\n  drawBoxes(img, object);\n}\n\nasync function showNextDetails(left) {\n  if ($('#popup').css('display') === 'none') return;\n\n  const img = document.getElementById('popup-image');\n  const id = filtered.findIndex((a) => a.image === img.img);\n  if (id === -1) return;\n  if (left === true && id > 0 && filtered[id - 1]) {\n    img.img = filtered[id - 1].image;\n    img.src = filtered[id - 1].image;\n  } else if (left === false && id <= filtered.length && filtered[id + 1]) {\n    img.img = filtered[id + 1].image;\n    img.src = filtered[id + 1].image;\n  }\n}\n\n// adds dividiers based on sort order\nlet previous;\nfunction addDividers(object) {\n  if (options.listDivider === 'month') {\n    const curr = moment(1000 * object.exif.timestamp).format(options.dateDivider);\n    const prev = moment(previous ? 1000 * previous.exif.timestamp : 0).format(options.dateDivider);\n    if (curr !== prev) $('#results').append(`<div class=\"row divider\">${curr}</div>`);\n  }\n  if (options.listDivider === 'size') {\n    const curr = Math.round(object.pixels / 1000 / 1000);\n    const prev = Math.round((previous ? previous.pixels : 1) / 1000 / 1000);\n    if (curr !== prev) $('#results').append(`<div class=\"row divider\">Size: ${curr} MP</div>`);\n  }\n  if (options.listDivider === 'folder') {\n    const curr = object.image.substr(0, object.image.lastIndexOf('/'));\n    const prev = previous ? previous.image.substr(0, previous.image.lastIndexOf('/')) : 'none';\n    if (curr !== prev) $('#results').append(`<div class=\"row divider\">${curr}</div>`);\n  }\n}\n\n// print results strip with thumbnail for a given object\nasync function printResult(object) {\n  addDividers(object);\n  previous = object;\n  let classified = '';\n  let all = [...object.classify || [], ...object.alternative || []];\n  if (all.length > 0) {\n    classified = 'Classified';\n    all = all.sort((a, b) => b.score - a.score).map((a) => a.class);\n    all = [...new Set(all)];\n    for (const item of all) {\n      classified += ` | ${item}`;\n    }\n  }\n  let person = '';\n  let nsfw = '';\n  if (object.person && object.person[0]) person = 'People';\n  for (const i in object.person) {\n    person += ` | ${object.person[i].gender} ${object.person[i].age.toFixed(0)}`;\n    if (object.person[i].class) {\n      nsfw += `Class: ${object.person[i].class} `;\n    }\n  }\n  let detected = '';\n  let personCount = 0;\n  if (object.detect && object.detect[0]) {\n    detected = 'Detected';\n    for (const obj of object.detect) {\n      if (obj.class !== 'person') detected += ` | ${obj.class}`;\n      else personCount++;\n    }\n    personCount = Math.max(personCount, object.person ? object.person.length : 0);\n    if (personCount === 1) detected += ' | person';\n    else if (personCount > 1) detected += ` | ${personCount} persons`;\n  }\n  let location = '';\n  if (object.location && object.location.city) {\n    location = 'Location';\n    location += ` | ${object.location.city}, ${object.location.state} ${object.location.country} (near ${object.location.near})`;\n  }\n\n  const timestamp = moment(1000 * object.exif.timestamp).format(options.dateShort);\n  const link = `<a class=\"download fa fa-arrow-alt-circle-down\" href=\"${object.image}\" download></a>`;\n  const divItem = document.createElement('div');\n  divItem.className = 'listitem';\n\n  const root = window.user && window.user.root ? window.user.root : 'media/';\n  divItem.innerHTML = `\n    <div class=\"col thumbnail\">\n      <img class=\"thumbnail\" id=\"thumb-${object.id}\" src=\"${object.thumbnail}\" align=\"middle\" width=${options.listThumbSize}px height=${options.listThumbSize}px>\n    </div>\n    <div id=\"desc-${object.id}\" class=\"col description\">\n      <b>${decodeURI(object.image).replace(root, '')}</b>${link}<br>\n      ${timestamp} | Size ${object.naturalSize.width} x ${object.naturalSize.height}<br>\n      ${location}<br>\n      ${classified}<br>\n      ${detected}<br>\n      ${person} ${nsfw}<br>\n    </div>\n  `;\n  $('#results').append(divItem);\n  const divThumb = document.getElementById(`thumb-${object.id}`);\n  divThumb.img = object.image;\n  const img = document.getElementById('popup-image');\n  img.addEventListener('load', showDetails);\n  divThumb.addEventListener('click', (evt) => {\n    img.img = evt.target.img;\n    img.src = object.image; // this triggers showDetails via onLoad event(\n  });\n}\n\nfunction resizeResults() {\n  const thumbSize = parseInt($('#thumbsize')[0].value, 10);\n  if (thumbSize !== options.listThumbSize) {\n    options.listThumbSize = thumbSize;\n    $('#thumblabel').text(`Size: ${options.listThumbSize}px`);\n    $('#thumbsize')[0].value = options.listThumbSize;\n    $('.thumbnail').width(options.listThumbSize);\n    $('.thumbnail').height(options.listThumbSize);\n    $('.listitem').css('min-height', `${Math.max(144, 16 + options.listThumbSize)}px`);\n    $('.listitem').css('max-height', '144px');\n  }\n}\n\nasync function enumerateFolders() {\n  $('#folders').html('');\n  const list = [];\n  for (const item of filtered) {\n    const path = item.image.substr(0, item.image.lastIndexOf('/'));\n    const folders = path.split('/').filter((a) => a !== '');\n    if (!list.find((a) => a.path === path)) list.push({ path, folders });\n  }\n  for (let i = 0; i < 10; i++) {\n    for (const item of list) {\n      if (item.folders[i]) {\n        const folder = item.folders[i];\n        const parent = item.folders[i > 0 ? i - 1 : 0];\n        let path = '';\n        for (let j = 0; j <= i; j++) path += `${item.folders[j]}/`;\n        const root = window.user && window.user.root ? window.user.root : 'media/';\n        const name = folder === root.replace(/\\//g, '') ? 'All' : folder;\n        const html = `\n          <li id=\"dir-${folder}\">\n            <span tag=\"${path}\" style=\"padding-left: ${i * 16}px\" class=\"folder\">&nbsp\n              <i tag=\"${path}\" class=\"fas fa-caret-right\">&nbsp</i>${name}\n            </span>\n          </li>\n        `;\n        let parentElem = $(`#dir-${parent}`);\n        if (parentElem.length === 0) parentElem = $('#folders');\n        const currentElem = $(`#dir-${folder}`);\n        if (currentElem.length === 0) parentElem.append(html);\n      }\n    }\n  }\n\n  // $('#folders').html(html);\n  $('.folder').click((evt) => {\n    $('body').css('cursor', 'wait');\n    const path = $(evt.target).attr('tag');\n    log.result(`Showing path: ${path}`);\n    const root = window.user && window.user.root ? window.user.root : 'media/';\n    if (path === root) filtered = results;\n    else filtered = results.filter((a) => a.image.startsWith(path));\n    // eslint-disable-next-line no-use-before-define\n    redrawResults(false);\n  });\n}\n\nasync function redrawResults(generateFolders = true) {\n  $('#number').html(filtered.length);\n  $('#results').html('');\n  if (generateFolders) enumerateFolders();\n  for await (const obj of filtered) printResult(obj);\n  $('.description').toggle(options.listDetails);\n  await resizeResults();\n  $('body').css('cursor', 'pointer');\n}\n\nfunction filterWord(object, word) {\n  if (!object) return null;\n  const skip = ['in', 'a', 'the', 'of', 'with', 'using', 'wearing', 'and', 'at', 'during'];\n  if (skip.includes(word)) return object;\n  const res = object.filter((obj) => {\n    let ok = false;\n    for (const tag of obj.tags) {\n      const str = Object.values(tag) && Object.values(tag)[0] ? Object.values(tag)[0].toString() : '';\n      ok |= str.startsWith(word.toLowerCase());\n    }\n    return ok;\n  });\n  return res;\n}\n\nfunction filterResults(words) {\n  $('body').css('cursor', 'wait');\n  filtered = results;\n  previous = null;\n  let foundWords = 0;\n  for (const word of words.split(' ')) {\n    filtered = filterWord(filtered, word);\n    foundWords += (filtered && filtered.length > 0) ? 1 : 0;\n  }\n  if (filtered && filtered.length > 0) log.result(`Searching for \"${words}\" found ${foundWords} words in ${filtered.length || 0} results out of ${results.length} matches`);\n  else log.result(`Searching for \"${words}\" found ${foundWords} of ${words.split(' ').length} terms`);\n  redrawResults();\n}\n\n// Fisher-Yates (aka Knuth) Shuffle\nfunction shuffle(array) {\n  let currentIndex = array.length;\n  let temporaryValue;\n  let randomIndex;\n  while (currentIndex !== 0) {\n    randomIndex = Math.floor(Math.random() * currentIndex);\n    currentIndex -= 1;\n    temporaryValue = array[currentIndex];\n    // eslint-disable-next-line no-param-reassign\n    array[currentIndex] = array[randomIndex];\n    // eslint-disable-next-line no-param-reassign\n    array[randomIndex] = temporaryValue;\n  }\n  return array;\n}\n\nfunction findDuplicates() {\n  $('body').css('cursor', 'wait');\n  previous = null;\n  filtered = [];\n  for (const obj of results) {\n    const items = results.filter((a) => a.hash === obj.hash);\n    if (items.length !== 1) filtered.push(...items);\n  }\n  filtered = [...new Set(filtered)];\n  log.result(`Duplicates: ${filtered.length}`);\n  redrawResults();\n}\n\nfunction sortResults(sort) {\n  $('body').css('cursor', 'wait');\n  log.result(`Sorting: ${sort}`);\n  if (!filtered || filtered.length === 0) filtered = results;\n  if (sort.includes('random')) shuffle(filtered);\n  previous = null;\n  // sort by\n  if (sort.includes('alpha-down')) filtered.sort((a, b) => (a.image > b.image ? 1 : -1));\n  if (sort.includes('alpha-up')) filtered.sort((a, b) => (a.image < b.image ? 1 : -1));\n  if (sort.includes('numeric-down')) filtered.sort((a, b) => (b.exif.timestamp - a.exif.timestamp));\n  if (sort.includes('numeric-up')) filtered.sort((a, b) => (a.exif.timestamp - b.exif.timestamp));\n  if (sort.includes('amount-down')) filtered.sort((a, b) => (b.pixels - a.pixels));\n  if (sort.includes('amount-up')) filtered.sort((a, b) => (a.pixels - b.pixels));\n  // how to group\n  if (sort.includes('numeric-down') || sort.includes('numeric-up')) options.listDivider = 'month';\n  else if (sort.includes('amount-down') || sort.includes('amount-up')) options.listDivider = 'size';\n  else if (sort.includes('alpha-down') || sort.includes('alpha-up')) options.listDivider = 'folder';\n  else options.listDivider = '';\n  redrawResults();\n}\n\n// calls main detectxion and then print results for all images matching spec\nasync function loadGallery(limit) {\n  $('body').css('cursor', 'wait');\n  const t0 = window.performance.now();\n  log.result('Loading gallery ...');\n  const res = await fetch(`/api/get?limit=${limit}&find=all`);\n  results = await res.json();\n  const t1 = window.performance.now();\n  const size = JSON.stringify(results).length;\n  log.result(`Received ${results.length} images in ${size.toLocaleString()} bytes (${Math.round(size / (t1 - t0)).toLocaleString()} KB/sec)`);\n  for (const id in results) results[id].id = id;\n  filtered = results;\n  resizeResults();\n  sortResults(options.listSortOrder);\n}\n\nasync function initUser() {\n  const res = await fetch('/api/user');\n  if (res.ok) window.user = await res.json();\n  if (window.user) {\n    $('#btn-user').toggleClass('fa-user-slash fa-user');\n    $('#user').text(window.user.user);\n    log.result(`Logged in: ${window.user.user} root:${window.user.root} admin:${window.user.admin}`);\n    if (window.user.admin) $('#btn-update').css('color', 'lightyellow');\n  }\n  // val = JSON.stringify(cookieStr)\n  // val = btoa(val)\n  // initialize per user config\n  $('body').css('fontSize', options.fontSize);\n  $('#folderbar').toggle(options.listFolders);\n  $('.description').toggle(options.listDetails);\n  $('#thumbsize')[0].value = options.listThumbSize;\n}\n\n// pre-fetching DOM elements to avoid multiple runtime lookups\nfunction initHandlers() {\n  // navbar\n  $('#btn-user').click(() => {\n    $.post('/client/auth.html');\n    if ($('#btn-user').hasClass('fa-user-slash')) window.location = '/client/auth.html';\n    $('#btn-user').toggleClass('fa-user-slash fa-user');\n  });\n\n  $('#btn-search').click(() => {\n    $('#optionslist').toggle(false);\n    $('#optionsview').toggle(false);\n    $('#searchbar').toggle('fast');\n    $('#btn-search').toggleClass('fa-search fa-search-location');\n    $('#search-input').focus();\n  });\n\n  $('#btn-list').click(() => {\n    $('#searchbar').toggle(false);\n    $('#optionsview').toggle(false);\n    $('#optionslist').toggle('fast');\n  });\n\n  $('#btn-view').click(() => {\n    $('#searchbar').toggle(false);\n    $('#optionslist').toggle(false);\n    $('#optionsview').toggle('fast');\n  });\n\n  $('#btn-doc').click(async () => {\n    // window.open('https://github.com/vladmandic/photo-analysis/blob/master/README.md', '_blank');\n    $('#docs').toggle('fast');\n    $('#docs').click(() => $('#docs').toggle('fast'));\n    const res = await fetch('/README.md');\n    const md = await res.text();\n    if (md) $('#docs').html(marked(md));\n  });\n\n  $('#btn-load').click((evt) => {\n    showTip(evt.target, 'Loading full gallery...');\n    loadGallery(10000);\n  });\n\n\n  // starts image processing in a separate window\n  $('#btn-update').click(() => {\n    if (window.user.admin) {\n      log.result('Image database update requested ...');\n      $('#searchbar').toggle(false);\n      $('#optionslist').toggle(false);\n      $('#optionsview').toggle(false);\n      window.open('/process', '_blank');\n    } else {\n      log.result('Image database update not authorized');\n    }\n  });\n\n  // starts live video detection in a separate window\n  $('#btn-video').click(() => {\n    window.open('/video', '_blank');\n  });\n\n  // navline-search\n  $('#search-input').keyup(() => {\n    event.preventDefault();\n    if (event.keyCode === 191) $('#search-input')[0].value = ''; // reset on key=/\n    if (event.keyCode === 13) filterResults($('#search-input')[0].value);\n  });\n\n  $('#btn-searchnow').click(() => {\n    filterResults($('#search-input')[0].value);\n  });\n\n  $('#btn-resetsearch').click(() => {\n    $('#search-input')[0].value = '';\n    filterResults('');\n  });\n\n  // navline-list\n  $('#btn-folder').click(() => {\n    $('#folderbar').toggle('slow');\n    $('#btn-folder').toggleClass('fa-folder fa-folder-open');\n    options.listFolders = !options.listFolders;\n  });\n\n  $('#btn-desc').click(() => {\n    options.listDetails = !options.listDetails;\n    $('.description').toggle('slow');\n    $('#btn-desc').toggleClass('fa-eye fa-eye-slash');\n  });\n\n  $('#find-duplicates').click(() => {\n    findDuplicates();\n  });\n\n  $('.sort').click((evt) => {\n    options.listSortOrder = evt.target.className;\n    sortResults(evt.target.className);\n  });\n\n  $('#thumbsize').on('input', () => {\n    resizeResults();\n  });\n\n  // navline-view\n  $('#details-desc').click(() => {\n    $('#details-desc').toggleClass('fa-comment fa-comment-slash');\n    options.viewDetails = !options.viewDetails;\n  });\n\n  $('#details-boxes').click(() => {\n    $('#details-boxes').toggleClass('fa-store fa-store-slash');\n    options.viewBoxes = !options.viewBoxes;\n  });\n\n  $('#details-faces').click(() => {\n    $('#details-faces').toggleClass('fa-head-side-cough fa-head-side-cough-slash');\n    options.viewFaces = !options.viewFaces;\n  });\n\n  $('#details-raw').click(() => {\n    $('#details-raw').toggleClass('fa-video fa-video-slash');\n    options.viewRaw = !options.viewRaw;\n  });\n\n  // handle clicks inside popup\n  $('#popup').click(() => {\n    if (event.screenX < 50) showNextDetails(true);\n    else if (event.screenX > window.innerWidth - 50) showNextDetails(false);\n    else $('#popup').toggle('fast');\n  });\n\n  // handle keypresses on main\n  $('html').keydown(() => {\n    const current = $('#results').scrollTop();\n    const line = options.listThumbSize + 16;\n    const page = $('#results').height() - options.listThumbSize;\n    const bottom = $('#results').prop('scrollHeight');\n    $('#results').stop();\n    switch (event.keyCode) {\n      case 38: $('#results').animate({ scrollTop: current - line }, 400); break; // key=up: scroll line up\n      case 40: $('#results').animate({ scrollTop: current + line }, 400); break; // key=down; scroll line down\n      case 33: $('#results').animate({ scrollTop: current - page }, 400); break; // key=pgup; scroll page up\n      case 34: $('#results').animate({ scrollTop: current + page }, 400); break; // key=pgdn; scroll page down\n      case 36: $('#results').animate({ scrollTop: 0 }, 1000); break; // key=home; scroll to top\n      case 35: $('#results').animate({ scrollTop: bottom }, 1000); break; // key=end; scroll to bottom\n      case 37: showNextDetails(true); break; // key=left; previous image in details view\n      case 39: showNextDetails(false); break; // key=right; next image in details view\n      case 191: $('#btn-search').click(); break; // key=/; open search input\n      case 190: $('#btn-sort').click(); break; // key=.; open sort options\n      case 188: $('#btn-desc').click(); break; // key=,; show/hide list descriptions\n      case 220: loadGallery(); break; // key=\\; refresh all\n      case 27:\n        $('#popup').toggle(false);\n        $('#searchbar').toggle(false);\n        $('#optionslist').toggle(false);\n        $('#optionsview').toggle(false);\n        $('#popup').toggle(false);\n        filterResults('');\n        break; // key=esc; clear all filters\n      default: // log.result('Unhandled keydown event', event.keyCode);\n    }\n  });\n}\n\nfunction hideElements() {\n  // hide those elements initially\n  $('#popup').toggle(false);\n  $('#docs').toggle(false);\n  $('#searchbar').toggle(false);\n  $('#optionslist').toggle(false);\n  $('#optionsview').toggle(false);\n  $('#btn-update').css('color', 'grey');\n}\n\nasync function main() {\n  await hideElements();\n\n  // google analytics\n  gtag('js', new Date());\n  gtag('config', 'UA-155273-2', { page_path: `${location.pathname}` });\n  gtag('set', { user_id: `${window.user}` }); // Set the user ID using signed-in user_id.\n\n  // Register PWA\n  if (config.registerPWA) pwa.register('/client/pwa-serviceworker.js');\n\n  await initUser();\n  initHandlers();\n  await loadGallery(options.listLimit);\n}\n\nwindow.onload = main;\n"]}