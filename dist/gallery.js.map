{"version":3,"sources":["config.js","log.js","gallery.js"],"names":["config","backEnd","maxSize","thumbnail","batchProcessing","squareImage","floatPrecision","classify","name","modelPath","score","topK","detect","overlap","person","type","div","dot","Log","innerHTML","result","msg","msgs","map","a","replace","length","fetch","then","res","text","console","log","active","Active","init","document","getElementById","results","initDivs","Result","Popup","PopupImage","PopupDetails","Found","Toggle","addEventListener","evt","toggleDetails","Filter","event","preventDefault","keyCode","filterResults","value","canvas","style","background","item","getElementsByClassName","display","drawBoxes","img","object","position","left","offsetLeft","top","offsetTop","width","height","ctx","getContext","linewidth","font","resizeX","processedSize","resizeY","strokeStyle","fillStyle","obj","x","box","y","beginPath","rect","stroke","fillText","toFixed","class","face","pointSize","pt","points","arc","Math","PI","fill","showDetails","resid","classified","detected","age","scoreGender","gender","scoreEmotion","emotion","nsfw","scoreClass","desc","descriptions","description","lines","exif","mp","naturalWidth","naturalHeight","complexity","bytes","make","model","lens","toLocaleString","created","Date","modified","software","exposure","fov","iso","apperture","location","city","country","continent","near","lat","lon","image","perf","total","onclick","printResult","camera","divItem","createElement","id","decodeURI","naturalSize","appendChild","target","src","filterWord","word","skip","includes","filter","ok","tag","tags","str","Object","values","toString","startsWith","toLowerCase","words","found","foundWords","split","innerText","loadGallery","json","JSON","stringify","main","window","onload"],"mappings":"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","file":"gallery.js","sourceRoot":"../client","sourcesContent":["/* eslint-disable no-multi-spaces */\n\nconst config = {\n  // General configuration\n  backEnd: 'webgl',        // back-end used by tensorflow for image processing, can be webgl, cpu, wasm\n  maxSize: 780,            // maximum image width or height that will be used for processing before resizing is required\n  thumbnail: 128,          // resolution in which to store image thumbnail embedded in result set\n  batchProcessing: 20,     // how many images to process in parallel\n  squareImage: false,      // resize proportional to the original image or to a square image\n  floatPrecision: false,    // use float32 or float16 for WebGL tensors\n\n  // Default models\n  classify: { name: 'Inception v3', modelPath: 'models/inception-v3/model.json', score: 0.2, topK: 3 },\n  detect: { name: 'Coco/SSD v2', modelPath: 'models/cocossd-v2/model.json', score: 0.4, topK: 6, overlap: 0.1 },\n  person: { name: 'FaceAPI SSD', modelPath: 'models/faceapi/', score: 0.4, topK: 1, type: 'ssdMobilenetv1' },\n\n  // alternative classification models - you can pick none of one\n  /*\n  classify: { name: 'MobileNet v1', modelPath: '/models/mobilenet-v1/model.json' },\n  classify: { name: 'MobileNet v2', modelPath: '/models/mobilenet-v2/model.json' },\n  classify: { name: 'Inception v1', modelPath: 'https://tfhub.dev/google/tfjs-model/imagenet/inception_v1/classification/3/default/1' },\n  classify: { name: 'Inception v2', modelPath: 'https://tfhub.dev/google/tfjs-model/imagenet/inception_v2/classification/3/default/1' },\n  classify: { name: 'Inception v3', modelPath: '/models/inception-v3/model.json' },\n  classify: { name: 'Inception ResNet v2', modelPath: '/models/inception-resnet-v2/model.json' },\n  classify: { name: 'ResNet v2', modelPath: 'https://tfhub.dev/google/tfjs-model/imagenet/resnet_v2_101/classification/3/default/1' },\n  classify: { name: 'NasNet Mobile', modelPath: 'https://tfhub.dev/google/tfjs-model/imagenet/nasnet_mobile/classification/3/default/1' },\n  */\n\n  // alternative detect models: enable darknet/yolo model in a separate module - you can pick none, enable coco/ssd-v2 or enable darknet/yolo (not js module is initialized by default)\n  // detect: { name: 'Coco/SSD v2', modelPath: 'models/cocossd-v2/model.json', score: 0.4, topK: 6, overlap: 0.1 },\n\n  // alternative face-api models - you can pick none or one of following\n  /*\n  person: { name: 'FaceAPI SSD', modelPath: 'models/faceapi/', score: 0.5, topK: 1, type: 'ssdMobilenetv1' },\n  person: { name: 'FaceAPI Yolo', modelPath: 'models/faceapi/', score: 0.5, topK: 1, type: 'tinyYolov2' },\n  person: { name: 'FaceAPI Tiny', modelPath: 'models/faceapi/', score: 0.5, topK: 1, type: 'tinyFaceDetector' },\n  person: { name: 'FaceAPI MTCNN', modelPath: 'models/faceapi/', score: 0.5, topK: 1, type: 'mtcnn' },\n  */\n};\n\nexport default config;\n","const div = {};\n\nasync function dot() {\n  div.Log.innerHTML += '.';\n}\n\nasync function result(...msg) {\n  let msgs = '';\n  msgs += msg.map((a) => a);\n  if (div && div.Log) div.Log.innerHTML += `${msgs.replace(' ', '&nbsp')}<br>`;\n  if (msgs.length > 0) fetch(`/log?msg=${msgs}`).then((res) => res.text());\n  // eslint-disable-next-line no-console\n  console.log(...msg);\n}\n\nasync function active(...msg) {\n  if (div && div.Active) div.Active.innerHTML = `${msg}<br>`;\n  // eslint-disable-next-line no-console\n  else console.log(...msg);\n}\n\nfunction init() {\n  div.Log = document.getElementById('log');\n  div.Active = document.getElementById('active');\n}\n\nconst log = {\n  result,\n  active,\n  init,\n  dot,\n};\n\nexport default log;\n","import config from './config.js';\nimport log from './log.js';\n\nlet results = [];\nconst div = {};\n\n// pre-fetching DOM elements to avoid multiple runtime lookups\nfunction initDivs() {\n  div.Result = document.getElementById('result');\n  div.Popup = document.getElementById('popup');\n  div.PopupImage = document.getElementById('popup-image');\n  div.PopupDetails = document.getElementById('popup-details');\n  div.Found = document.getElementById('found');\n  div.Toggle = document.getElementById('toggle');\n  // eslint-disable-next-line no-use-before-define\n  div.Toggle.addEventListener('click', (evt) => toggleDetails(evt));\n  div.Filter = document.getElementById('filter');\n  div.Filter.addEventListener('keyup', (event) => {\n    event.preventDefault();\n    // eslint-disable-next-line no-use-before-define\n    if (event.keyCode === 13) filterResults(div.Filter.value);\n  });\n  div.canvas = document.getElementById('popup-canvas');\n}\n\nfunction toggleDetails() {\n  if (div.Toggle.style.background === 'lightcoral') {\n    div.Toggle.style.background = 'lightgreen';\n    for (const item of document.getElementsByClassName('desc')) {\n      item.style.display = 'inline  ';\n    }\n  } else {\n    div.Toggle.style.background = 'lightcoral';\n    for (const item of document.getElementsByClassName('desc')) {\n      item.style.display = 'none';\n    }\n  }\n}\n// draw boxes for detected objects, faces and face elements\nfunction drawBoxes(img, object) {\n  div.canvas.style.position = 'absolute';\n  div.canvas.style.left = img.offsetLeft;\n  div.canvas.style.top = img.offsetTop;\n  div.canvas.width = img.width;\n  div.canvas.height = img.height;\n  const ctx = div.canvas.getContext('2d');\n  ctx.linewidth = 2;\n  ctx.font = '16px Roboto';\n  const resizeX = img.width / object.processedSize.width;\n  const resizeY = img.height / object.processedSize.height;\n\n  // draw detected objects\n  if (object.detect) {\n    ctx.strokeStyle = 'lightyellow';\n    ctx.fillStyle = 'lightyellow';\n    for (const obj of object.detect) {\n      const x = obj.box[0] * resizeX;\n      const y = obj.box[1] * resizeY;\n      ctx.beginPath();\n      ctx.rect(x, y, obj.box[2] * resizeX, obj.box[3] * resizeY);\n      ctx.stroke();\n      ctx.fillText(`${(100 * obj.score).toFixed(0)}% ${obj.class}`, x + 2, y + 18);\n    }\n  }\n\n  // draw faces\n  if (object.person && object.person.face) {\n    // draw box around face\n    const x = object.person.face.box.x * resizeX;\n    const y = object.person.face.box.y * resizeY;\n    ctx.strokeStyle = 'deepskyblue';\n    ctx.fillStyle = 'deepskyblue';\n    ctx.beginPath();\n    ctx.rect(x, y, object.person.face.box.width * resizeX, object.person.face.box.height * resizeY);\n    ctx.stroke();\n    ctx.fillText('face', x + 2, y + 18);\n\n    // draw face points\n    ctx.fillStyle = 'lightblue';\n    const pointSize = 2;\n    for (const pt of object.person.face.points) {\n      ctx.beginPath();\n      ctx.arc(pt.x * resizeX, pt.y * resizeY, pointSize, 0, 2 * Math.PI);\n      ctx.fill();\n    }\n\n    /*\n    const jaw = object.person.boxes.landmarks.getJawOutline() || [];\n    const nose = object.person.boxes.landmarks.getNose() || [];\n    const mouth = object.person.boxes.landmarks.getMouth() || [];\n    const leftEye = object.person.boxes.landmarks.getLeftEye() || [];\n    const rightEye = object.person.boxes.landmarks.getRightEye() || [];\n    const leftEyeBrow = object.person.boxes.landmarks.getLeftEyeBrow() || [];\n    const rightEyeBrow = object.person.boxes.landmarks.getRightEyeBrow() || [];\n    faceDetails = `Points jaw:${jaw.length} mouth:${mouth.length} nose:${nose.length} left-eye:${leftEye.length} right-eye:${rightEye.length} left-eyebrow:${leftEyeBrow.length} right-eyebrow:${rightEyeBrow.length}`;\n    */\n  }\n}\n\n// show details popup\nasync function showDetails() {\n  const object = results[div.PopupImage.resid];\n  if (!object) return;\n  div.Popup.style.display = 'flex';\n\n  let classified = 'Classified ';\n  if (object.classify) for (const obj of object.classify) classified += ` | ${(100 * obj.score).toFixed(0)}% ${obj.class}`;\n\n  let detected = 'Detected ';\n  if (object.detect) for (const obj of object.detect) detected += ` | ${(100 * obj.score).toFixed(0)}% ${obj.class}`;\n\n  let person = '';\n  if (object.person && object.person.age) {\n    person = `Person | \n        Gender: ${(100 * object.person.scoreGender).toFixed(0)}% ${object.person.gender} | \n        Age: ${object.person.age.toFixed(1)} | \n        Emotion: ${(100 * object.person.scoreEmotion).toFixed(0)}% ${object.person.emotion}`;\n  }\n\n  let nsfw = '';\n  if (object.person && object.person.class) {\n    nsfw = `Class: ${(100 * object.person.scoreClass).toFixed(0)}% ${object.person.class} `;\n  }\n\n  let desc = '<h2>Description:</h2><ul>';\n  if (object.descriptions) {\n    for (const description of object.descriptions) {\n      for (const lines of description) {\n        desc += `<li><b>${lines.name}</b>: <i>${lines.desc}</i></li>`;\n      }\n      desc += '<br>';\n    }\n  }\n  desc += '</ul>';\n\n  let exif = '';\n  if (object.exif) {\n    const mp = (div.PopupImage.naturalWidth * div.PopupImage.naturalHeight / 1000000).toFixed(1);\n    const complexity = (div.PopupImage.naturalWidth * div.PopupImage.naturalHeight) / object.exif.bytes;\n    if (object.exif.make) exif += `Camera: ${object.exif.make} ${object.exif.model || ''} ${object.exif.lens || ''}<br>`;\n    if (object.exif.bytes) exif += `Size: ${mp} MP in ${object.exif.bytes.toLocaleString()} bytes with compression factor ${complexity.toFixed(2)}<br>`;\n    if (object.exif.created) exif += `Taken: ${new Date(1000 * object.exif.created).toLocaleString()} Edited: ${new Date(1000 * object.exif.modified).toLocaleString()}<br>`;\n    if (object.exif.software) exif += `Software: ${object.exif.software}<br>`;\n    if (object.exif.exposure) exif += `Settings: ${object.exif.fov || 0}mm ISO${object.exif.iso || 0} f/${object.exif.apperture || 0} 1/${(1 / (object.exif.exposure || 1)).toFixed(0)}sec<br>`;\n  }\n  let location = '';\n  if (object.location && object.location.city) location += `Location: ${object.location.city}, ${object.location.country}, ${object.location.continent} (near ${object.location.near})<br>`;\n  if (object.exif && object.exif.lat) location += `Coordinates: Lat ${object.exif.lat.toFixed(3)} Lon ${object.exif.lon.toFixed(3)}<br>`;\n\n  div.PopupDetails.innerHTML = `\n      <h2>Image: ${object.image}</h2>\n      Image size: ${div.PopupImage.naturalWidth} x ${div.PopupImage.naturalHeight}\n        Processed in ${object.perf.total.toFixed(0)} ms<br>\n        Classified using ${config.classify ? config.classify.name : 'N/A'} in ${object.perf.classify.toFixed(0)} ms<br>\n        Detected using ${config.detect ? config.detect.name : 'N/A'} in ${object.perf.detect.toFixed(0)} ms<br>\n        Person using ${config.person ? config.person.name : 'N/A'} in ${object.perf.person.toFixed(0)} ms<br>\n      <h2>Image Data</h2>\n      ${exif}\n      <h2>Location</h2>\n      ${location}\n      <h2>${classified}</h2>\n      <h2>${detected}</h2>\n      <h2>${person} ${nsfw}</h2>\n      ${desc}\n      </div>\n    `;\n\n  // const faceDetails = drawBoxes(div.PopupImage, object) || '';\n  drawBoxes(div.PopupImage, object);\n\n  div.Popup.onclick = () => { div.Popup.style.display = 'none'; };\n}\n\n// print results strip with thumbnail for a given object\nasync function printResult(object) {\n  let classified = '';\n  if (object.classify && object.classify[0]) {\n    classified = 'Classified';\n    for (const obj of object.classify) classified += ` | ${(100 * obj.score).toFixed(0)}% ${obj.class}`;\n  }\n  let detected = '';\n  if (object.detect && object.detect[0]) {\n    detected = 'Detected';\n    for (const obj of object.detect) detected += ` | ${(100 * obj.score).toFixed(0)}% ${obj.class}`;\n  }\n  let person = '';\n  if (object.person && object.person.age) {\n    person = `Person | \n      Gender: ${(100 * object.person.scoreGender).toFixed(0)}% ${object.person.gender} \n      Age: ${object.person.age.toFixed(1)} \n      Emotion: ${(100 * object.person.scoreEmotion).toFixed(0)}% ${object.person.emotion}`;\n  }\n  let nsfw = '';\n  if (object.person && object.person.class) {\n    nsfw = `Class: ${(100 * object.person.scoreClass).toFixed(0)}% ${object.person.class} `;\n  }\n  let location = '';\n  if (object.location && object.location.city) {\n    location = 'Location';\n    location += ` | ${object.location.city}, ${object.location.country}, ${object.location.continent} (near ${object.location.near})`;\n  }\n  let camera = '';\n  if (object.exif.make) {\n    camera = 'Camera';\n    camera += `: ${object.exif.make} ${object.exif.model || ''}`;\n  }\n\n  const divItem = document.createElement('div');\n  divItem.class = 'col';\n  divItem.style = 'display: flex';\n  divItem.innerHTML = `\n    <div class=\"col\" style=\"max-height: ${config.thumbnail}px; min-width: ${config.thumbnail}px; max-width: ${config.thumbnail}px; padding: 0\">\n      <img id=\"thumb-${object.id}\" src=\"${object.thumbnail}\" align=\"middle\" width=\"${config.thumbnail}px\" height=\"${config.thumbnail}px\">\n    </div>\n    <div id=\"desc-${object.id}\" class=\"col desc\" style=\"height: ${config.thumbnail}px; min-width: 564px; max-width: 564px; padding: 4px\">\n      <b>${decodeURI(object.image)}</b><br>\n      Image: ${object.naturalSize.width}x${object.naturalSize.height} ${camera}<br>\n      ${location}<br>\n      ${classified}<br>\n      ${detected}<br>\n      ${person} ${nsfw}<br>\n    </div>\n  `;\n  div.Result.appendChild(divItem);\n  document.getElementById(`thumb-${object.id}`).resid = object.id;\n  document.getElementById(`desc-${object.id}`).resid = object.id;\n  divItem.addEventListener('click', (evt) => {\n    div.PopupImage.resid = evt.target.resid;\n    div.PopupImage.src = object.image; // this triggers showDetails via onLoad event\n  });\n  div.PopupImage.addEventListener('load', showDetails); // don't call showDetails directly to ensure image is loaded\n}\n\nfunction filterWord(object, word) {\n  if (!object) return null;\n  const skip = ['in', 'a', 'the', 'of', 'with', 'using', 'wearing', 'and', 'at', 'during'];\n  if (skip.includes(word)) return object;\n  const res = object.filter((obj) => {\n    let ok = false;\n    for (const tag of obj.tags) {\n      const str = Object.values(tag)[0].toString() || '';\n      ok |= str.startsWith(word.toLowerCase());\n    }\n    return ok;\n  });\n  return res;\n}\n\nfunction filterResults(words) {\n  log.active('Searching ...');\n  let found = results;\n  let foundWords = 0;\n  for (const word of words.split(' ')) {\n    found = filterWord(found, word);\n    foundWords += (found && found.length > 0) ? 1 : 0;\n  }\n  log.result(`Searching for \"${words}\" found ${foundWords} words in ${found.length || 0} results out of ${results.length} matches`);\n  if (found && found.length > 0) div.Found.innerText = `Found ${found.length} results`;\n  else div.Found.innerText = `Found ${foundWords} of ${words.split(' ').length} words`;\n  div.Result.innerHTML = '';\n  for (const obj of found) {\n    printResult(obj);\n  }\n  log.active('Idle ...');\n}\n\n// calls main detectxion and then print results for all images matching spec\nasync function loadGallery() {\n  log.result('Loading gallery ...');\n  log.active('Loading gallery ...');\n  const res = await fetch('/get?find=all');\n  results = await res.json();\n  log.result(`Received ${results.length} images in ${JSON.stringify(results).length} bytes`);\n  for (const id in results) {\n    results[id].id = id;\n    log.active(`Printing: ${results[id].image}`);\n    printResult(results[id]);\n  }\n  log.active('Idle ...');\n}\n\nasync function main() {\n  initDivs();\n  log.init();\n  log.active('Starting ...');\n  await loadGallery();\n}\n\nwindow.onload = main;\n"]}